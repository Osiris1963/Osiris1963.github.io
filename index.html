<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales & Customer Forecaster</title>
    <!-- Chosen Palette: McDonald's Professional (Warm Gray, Red, Yellow, Dark Text) -->
    <!-- Application Structure Plan: The SPA uses a fixed top navigation bar to switch between content sections, mimicking the logical flow of the original app's tabs. This design was chosen because it provides clear, persistent navigation, allowing users to easily move between the main forecast 'Dashboard', component 'Insights', and performance 'Evaluator' without losing context. All content is dynamically rendered into a single main content area, making it a true single-page application focused on usability and a seamless user flow. -->
    <!-- Visualization & Content Choices: Data from the report is presented using Chart.js for all visualizations to maintain a consistent look and feel. Goal: Show Change -> Viz: A dual-axis line chart is used on the Dashboard to show sales/customer trends. Interaction: Hover tooltips provide specific data points. Goal: Organize/Explain -> Viz: A waterfall chart on the Insights page breaks down forecast components. Interaction: A dropdown filters the view by date. Goal: Compare -> Viz: Paired line charts on the Evaluator page compare actuals vs. forecasts. Interaction: Toggles filter the time range. Data management is handled via styled HTML forms and cards, providing a clear and standard interface. This approach avoids proscribed libraries and focuses on universally understood interactions. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #F7F7F7;
        }
        .nav-button {
            transition: all 0.3s ease;
        }
        .nav-button.active {
            background-color: #DA291C; /* McDonald's Red */
            color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 400px;
            max-height: 50vh;
        }
        .stat-card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            border: 1px solid #E5E7EB;
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-white shadow-md sticky top-0 z-10">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-20">
                    <div class="flex items-center space-x-4">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/McDonald%27s_Golden_Arches.svg/1200px-McDonald%27s_Golden_Arches.svg.png" alt="Logo" class="h-8 w-auto">
                        <h1 class="text-xl md:text-2xl font-bold text-gray-800">Sales & Customer Forecaster</h1>
                    </div>
                     <nav class="hidden md:flex space-x-2">
                        <button data-view="dashboard" class="nav-button active px-4 py-2 rounded-lg font-semibold">Dashboard</button>
                        <button data-view="insights" class="nav-button px-4 py-2 rounded-lg font-semibold">Insights</button>
                        <button data-view="evaluator" class="nav-button px-4 py-2 rounded-lg font-semibold">Evaluator</button>
                        <button data-view="datamgmt" class="nav-button px-4 py-2 rounded-lg font-semibold">Data Management</button>
                    </nav>
                </div>
            </div>
        </header>
        
        <!-- Mobile Navigation -->
        <nav class="md:hidden bg-white shadow-md p-2 flex justify-around sticky top-20 z-10">
            <button data-view="dashboard" class="nav-button active flex-1 text-sm py-2 rounded-lg font-semibold">Dashboard</button>
            <button data-view="insights" class="nav-button flex-1 text-sm py-2 rounded-lg font-semibold">Insights</button>
            <button data-view="evaluator" class="nav-button flex-1 text-sm py-2 rounded-lg font-semibold">Evaluator</button>
            <button data-view="datamgmt" class="nav-button flex-1 text-sm py-2 rounded-lg font-semibold">Data</button>
        </nav>


        <!-- Main Content Area -->
        <main id="content-area" class="flex-grow container mx-auto p-4 sm:p-6 lg:p-8">
            
            <!-- Dashboard Section -->
            <section id="dashboard-section" class="view">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold mb-1">Forecast Dashboard</h2>
                    <p class="text-gray-600">This section presents the 15-day outlook for projected sales and customer traffic, providing a high-level overview of expected performance.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="stat-card text-center">
                        <h3 class="text-lg font-semibold text-gray-500">Avg. Daily Sales (7-Day)</h3>
                        <p id="avg-sales" class="text-4xl font-bold text-[#DA291C] mt-2">₱0</p>
                    </div>
                    <div class="stat-card text-center">
                        <h3 class="text-lg font-semibold text-gray-500">Avg. Daily Customers (7-Day)</h3>
                        <p id="avg-customers" class="text-4xl font-bold text-gray-800 mt-2">0</p>
                    </div>
                    <div class="stat-card text-center">
                        <h3 class="text-lg font-semibold text-gray-500">Avg. Transaction Value (7-Day)</h3>
                        <p id="avg-atv" class="text-4xl font-bold text-gray-800 mt-2">₱0.00</p>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                     <h3 class="text-xl font-bold mb-4">15-Day Performance Outlook</h3>
                    <div class="chart-container">
                        <canvas id="forecastChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- Insights Section -->
            <section id="insights-section" class="view hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold mb-1">Forecast Insights</h2>
                    <p class="text-gray-600">Explore the underlying drivers of the daily forecast. This waterfall chart breaks down how factors like the day of the week, seasonality, and holidays contribute to the final customer projection.</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-4">
                        <h3 class="text-xl font-bold mb-2 sm:mb-0">Daily Driver Analysis</h3>
                        <div>
                            <label for="insightDate" class="font-semibold mr-2">Select a Date:</label>
                            <select id="insightDate" class="p-2 rounded-lg border-2 border-gray-200 focus:border-[#DA291C] focus:outline-none"></select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 items-center">
                        <div class="lg:col-span-2 chart-container">
                            <canvas id="waterfallChart"></canvas>
                        </div>
                        <div id="insight-summary" class="bg-gray-50 p-6 rounded-lg border">
                            <h4 class="font-bold text-lg mb-2">Summary</h4>
                            <p class="text-gray-700">Select a date to see a summary of its forecast drivers.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Evaluator Section -->
            <section id="evaluator-section" class="view hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold mb-1">Forecast Evaluator</h2>
                    <p class="text-gray-600">This section measures the model's historical accuracy by comparing past day-ahead forecasts against actual results. This helps build trust and identify areas for model improvement.</p>
                </div>
                <div class="flex justify-center mb-6">
                     <div class="inline-flex rounded-lg shadow-sm bg-white border">
                        <button id="eval-7-day" class="eval-toggle-button bg-[#DA291C] text-white px-4 py-2 rounded-l-lg font-semibold">Last 7 Days</button>
                        <button id="eval-30-day" class="eval-toggle-button px-4 py-2 font-semibold text-gray-600">Last 30 Days</button>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                     <div class="stat-card">
                         <h3 class="text-lg font-semibold text-gray-500">Sales Accuracy (vs MAPE)</h3>
                         <p id="sales-accuracy" class="text-3xl font-bold mt-1">0.00%</p>
                     </div>
                     <div class="stat-card">
                         <h3 class="text-lg font-semibold text-gray-500">Customer Accuracy (vs MAPE)</h3>
                         <p id="customer-accuracy" class="text-3xl font-bold mt-1">0.00%</p>
                     </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                        <h3 class="text-xl font-bold mb-4">Actual vs. Forecasted Sales</h3>
                        <div class="chart-container">
                            <canvas id="salesEvalChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                        <h3 class="text-xl font-bold mb-4">Actual vs. Forecasted Customers</h3>
                        <div class="chart-container">
                            <canvas id="customersEvalChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>
            
             <!-- Data Management Section -->
            <section id="datamgmt-section" class="view hidden">
                 <div class="mb-6">
                    <h2 class="text-2xl font-bold mb-1">Data Management</h2>
                    <p class="text-gray-600">Add new daily records for historical data, or log upcoming activities and promotions to improve forecast accuracy.</p>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                        <h3 class="text-xl font-bold mb-4">Add New Daily Record</h3>
                        <form id="daily-record-form" class="space-y-4">
                            <div>
                                <label for="record-date" class="block font-semibold mb-1">Date</label>
                                <input type="date" id="record-date" class="w-full p-2 rounded-lg border-2 border-gray-200" required>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="record-sales" class="block font-semibold mb-1">Total Sales (₱)</label>
                                    <input type="number" id="record-sales" class="w-full p-2 rounded-lg border-2 border-gray-200" required>
                                </div>
                                <div>
                                    <label for="record-customers" class="block font-semibold mb-1">Customers</label>
                                    <input type="number" id="record-customers" class="w-full p-2 rounded-lg border-2 border-gray-200" required>
                                </div>
                            </div>
                             <button type="submit" class="w-full bg-[#DA291C] text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition duration-300">Save Daily Record</button>
                        </form>
                    </div>
                     <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                        <h3 class="text-xl font-bold mb-4">Add Future Activity/Promotion</h3>
                        <form id="activity-form" class="space-y-4">
                             <div>
                                <label for="activity-name" class="block font-semibold mb-1">Activity Name</label>
                                <input type="text" id="activity-name" placeholder="e.g., Twister Fries Launch" class="w-full p-2 rounded-lg border-2 border-gray-200" required>
                            </div>
                             <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="activity-date" class="block font-semibold mb-1">Date</label>
                                    <input type="date" id="activity-date" class="w-full p-2 rounded-lg border-2 border-gray-200" required>
                                </div>
                                <div>
                                    <label for="activity-sales" class="block font-semibold mb-1">Est. Sales Impact (₱)</label>
                                    <input type="number" id="activity-sales" class="w-full p-2 rounded-lg border-2 border-gray-200" required>
                                </div>
                            </div>
                            <button type="submit" class="w-full bg-gray-800 text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-900 transition duration-300">Save Activity</button>
                        </form>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- MOCK DATA ---
            // This data would come from your database in a real application.
            // It's structured to simulate the outputs of your Python script.

            const today = new Date();
            const generateDates = (n) => Array.from({ length: n }, (_, i) => {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                return date;
            });
            
            const forecastData = {
                dates: generateDates(15),
                customers: [255, 260, 275, 350, 410, 420, 310, 265, 270, 280, 360, 415, 425, 315, 288],
                atv: [180.5, 181.2, 182.0, 185.5, 190.0, 191.5, 188.0, 183.0, 184.5, 185.0, 188.5, 192.0, 193.0, 189.5, 185.0]
            };
            forecastData.sales = forecastData.customers.map((c, i) => c * forecastData.atv[i]);

            const waterfallData = forecastData.dates.map((date, i) => ({
                date: date.toISOString().split('T')[0],
                trend: 250 + i * 2,
                weekly: (date.getDay() === 5 || date.getDay() === 6) ? (80 + i*5) : (date.getDay() === 0 ? 30 : -15), // Weekend/Sunday/Weekday effect
                holidays: date.getDate() === 25 ? 50 : 0, // Mock holiday effect
                get total() { return this.trend + this.weekly + this.holidays; }
            }));

            const evaluationData = {
                dates: Array.from({ length: 30 }, (_, i) => {
                    const date = new Date(today);
                    date.setDate(today.getDate() - 30 + i);
                    return date;
                }),
                actual_sales: Array.from({length: 30}, () => 48000 + Math.random() * 8000 - 4000),
                forecast_sales: Array.from({length: 30}, () => 49000 + Math.random() * 8000 - 4000),
                actual_customers: Array.from({length: 30}, () => 280 + Math.random() * 50 - 25),
                forecast_customers: Array.from({length: 30}, () => 285 + Math.random() * 50 - 25),
            };

            // --- GLOBAL STATE & CHARTS ---
            let charts = {};
            const appState = {
                currentView: 'dashboard',
                evalDays: 7,
            };

            // --- NAVIGATION LOGIC ---
            const navButtons = document.querySelectorAll('.nav-button');
            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const view = button.dataset.view;
                    appState.currentView = view;
                    updateView();
                });
            });

            function updateView() {
                document.querySelectorAll('.view').forEach(section => section.classList.add('hidden'));
                document.getElementById(`${appState.currentView}-section`).classList.remove('hidden');

                navButtons.forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.view === appState.currentView);
                });

                // Render the view's content/chart
                switch(appState.currentView) {
                    case 'dashboard': renderDashboard(); break;
                    case 'insights': renderInsights(); break;
                    case 'evaluator': renderEvaluator(); break;
                }
            }
            
            // --- RENDERING FUNCTIONS ---
            
            function renderDashboard() {
                const ctx = document.getElementById('forecastChart').getContext('2d');
                if(charts.forecast) charts.forecast.destroy();

                charts.forecast = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: forecastData.dates,
                        datasets: [
                            {
                                label: 'Predicted Sales (₱)',
                                data: forecastData.sales,
                                borderColor: '#DA291C',
                                backgroundColor: 'rgba(218, 41, 28, 0.1)',
                                yAxisID: 'ySales',
                                tension: 0.3,
                                fill: true,
                            },
                            {
                                label: 'Predicted Customers',
                                data: forecastData.customers,
                                borderColor: '#FFC72C',
                                backgroundColor: 'rgba(255, 199, 44, 0.1)',
                                yAxisID: 'yCustomers',
                                tension: 0.3,
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            x: { 
                                type: 'time',
                                time: { unit: 'day', tooltipFormat: 'MMM dd, yyyy' },
                                grid: { display: false }
                            },
                            ySales: {
                                type: 'linear',
                                position: 'left',
                                title: { display: true, text: 'Sales (₱)', font: {weight: 'bold'} },
                                grid: { color: '#E5E7EB' }
                            },
                            yCustomers: {
                                type: 'linear',
                                position: 'right',
                                title: { display: true, text: 'Customers', font: {weight: 'bold'} },
                                grid: { display: false }
                            }
                        },
                        plugins: {
                            legend: { position: 'top' },
                            tooltip: { mode: 'index', intersect: false }
                        },
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        }
                    }
                });
                
                // Update stats
                const weeklySales = forecastData.sales.slice(0, 7).reduce((a, b) => a + b, 0) / 7;
                const weeklyCustomers = forecastData.customers.slice(0, 7).reduce((a, b) => a + b, 0) / 7;
                document.getElementById('avg-sales').textContent = `₱${weeklySales.toLocaleString('en-US', {maximumFractionDigits: 0})}`;
                document.getElementById('avg-customers').textContent = `${Math.round(weeklyCustomers).toLocaleString()}`;
                document.getElementById('avg-atv').textContent = `₱${(weeklySales/weeklyCustomers).toFixed(2)}`;
            }

            function renderInsights() {
                const select = document.getElementById('insightDate');
                select.innerHTML = '';
                waterfallData.forEach(d => {
                    const option = document.createElement('option');
                    option.value = d.date;
                    option.textContent = new Date(d.date).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', timeZone: 'UTC' });
                    select.appendChild(option);
                });
                
                select.addEventListener('change', (e) => updateWaterfallChart(e.target.value));
                updateWaterfallChart(select.value);
            }

            function updateWaterfallChart(date) {
                const data = waterfallData.find(d => d.date === date);
                if (!data) return;

                const ctx = document.getElementById('waterfallChart').getContext('2d');
                if (charts.waterfall) charts.waterfall.destroy();
                
                charts.waterfall = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Baseline Trend', 'Day of Week', 'Holidays', 'Final Forecast'],
                        datasets: [{
                            label: 'Customer Forecast Breakdown',
                            data: [data.trend, data.weekly, data.holidays, data.total],
                            backgroundColor: ['#3B82F6', data.weekly > 0 ? '#10B981' : '#EF4444', data.holidays > 0 ? '#10B981' : '#EF4444', '#4B5563'],
                            barPercentage: 0.7,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        plugins: { legend: { display: false } },
                        scales: {
                            x: { title: { display: true, text: 'Number of Customers' } }
                        }
                    }
                });
                
                const summaryEl = document.getElementById('insight-summary');
                summaryEl.innerHTML = `
                    <h4 class="font-bold text-lg mb-2">Summary for ${new Date(date).toLocaleDateString('en-US', {month: 'long', day: 'numeric', timeZone: 'UTC'})}</h4>
                    <p class="mb-2">The forecast starts with a baseline trend of <strong>${data.trend.toFixed(0)}</strong> customers.</p>
                    <p class="mb-2">The day of the week effect is ${data.weekly > 0 ? 'positive' : 'negative'}, adjusting the forecast by <strong>${data.weekly.toFixed(0)}</strong> customers.</p>
                    ${data.holidays !== 0 ? `<p class="mb-2">Holiday effects adjust the forecast by <strong>${data.holidays.toFixed(0)}</strong> customers.</p>` : ''}
                    <hr class="my-3">
                    <p class="font-bold">Resulting in a final forecast of <strong>${data.total.toFixed(0)}</strong> customers.</p>
                `;
            }
            
            function renderEvaluator() {
                const days = appState.evalDays;
                const dataSlice = {
                    dates: evaluationData.dates.slice(-days),
                    actual_sales: evaluationData.actual_sales.slice(-days),
                    forecast_sales: evaluationData.forecast_sales.slice(-days),
                    actual_customers: evaluationData.actual_customers.slice(-days),
                    forecast_customers: evaluationData.forecast_customers.slice(-days),
                };

                const salesMae = dataSlice.actual_sales.reduce((sum, val, i) => sum + Math.abs(val - dataSlice.forecast_sales[i]), 0) / days;
                const salesMape = dataSlice.actual_sales.reduce((sum, val, i) => sum + Math.abs((val - dataSlice.forecast_sales[i]) / val), 0) / days * 100;
                const custMae = dataSlice.actual_customers.reduce((sum, val, i) => sum + Math.abs(val - dataSlice.forecast_customers[i]), 0) / days;
                const custMape = dataSlice.actual_customers.reduce((sum, val, i) => sum + Math.abs((val - dataSlice.forecast_customers[i]) / val), 0) / days * 100;

                document.getElementById('sales-accuracy').textContent = `${(100 - salesMape).toFixed(2)}%`;
                document.getElementById('customer-accuracy').textContent = `${(100 - custMape).toFixed(2)}%`;

                const salesCtx = document.getElementById('salesEvalChart').getContext('2d');
                if(charts.salesEval) charts.salesEval.destroy();
                charts.salesEval = createEvalChart(salesCtx, dataSlice.dates, dataSlice.actual_sales, dataSlice.forecast_sales, 'Sales (₱)');

                const custCtx = document.getElementById('customersEvalChart').getContext('2d');
                if(charts.custEval) charts.custEval.destroy();
                charts.custEval = createEvalChart(custCtx, dataSlice.dates, dataSlice.actual_customers, dataSlice.forecast_customers, 'Customers');
            }
            
            function createEvalChart(ctx, dates, actuals, forecasts, label) {
                return new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: dates,
                        datasets: [
                            {
                                label: 'Actual',
                                data: actuals,
                                borderColor: '#DA291C',
                                tension: 0.1
                            },
                            {
                                label: 'Forecast',
                                data: forecasts,
                                borderColor: '#FFC72C',
                                borderDash: [5, 5],
                                tension: 0.1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: { x: { type: 'time', time: { unit: 'day' } } },
                        plugins: { legend: { position: 'top' } }
                    }
                });
            }

            document.querySelectorAll('.eval-toggle-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    document.querySelectorAll('.eval-toggle-button').forEach(btn => {
                        btn.classList.remove('bg-[#DA291C]', 'text-white');
                        btn.classList.add('text-gray-600');
                    });
                    e.target.classList.add('bg-[#DA291C]', 'text-white');
                    e.target.classList.remove('text-gray-600');
                    appState.evalDays = e.target.id === 'eval-7-day' ? 7 : 30;
                    renderEvaluator();
                });
            });

            // Initial Load
            updateView();
        });
    </script>

</body>
</html>
